.. __Assignment:

Assignment
###########

Psuedo code
************

.. code-block:: C

    mutex mLock;
    random_num_gen r;

    uint8_t arr[1000] = {0};
    int numOfBytes = 0;

    void producer()
    {
        sleep(1000ms);
        mLock.lock();

        r.seed(std::time(nullptr));
        int n = r() % 50;

        std::generate(arr+numOfBytes, arr+numOfBytes+n, std::ref(r));

        numOfBytes += n;
        mLock.unlock();
    }

    void consumer()
    {
        sleep(10000ms);
        mLock.lock();

        if(numOfBytes >= 512)
        {
            int32_t remBytes = numOfBytes - 512;
            for(int32_t i = numOfBytes; i >= remBytes; i--)
            {
                std::printf("0x%x ", globalArray[i]);
            }
            
            numOfBytes = remBytes;
            std::printf("\nRemaining bytes: %d\n", numOfBytes);
        }
        else 
        {
            std::printf("\tThe number of bytes produced is less than 512, sleeping again\n");
        }

        mLock.unlock();
    }



Building and Running
********************

This application can be built and executed on linux using native_posix/native_sim as follows:

1. Set up the zephyr workspace to build projects:
    1.1  Update your linux distro

    1.2  Ensure you have latest version of

       .. code-block:: console

            cmake --version
            python --version
            dtc --version

        Installed. If not install them.
        
    1.3 setup a python venv workspace,

        .. code-block:: console

            python3 -m venv ~/zephyrproject/.venv
            source ~/zephyrproject/.venv/bin/activate

    1.4 Install west and get zephyr source code 

        .. code-block:: console

            pip install west
            west init ~/zephyrproject
            cd ~/zephyrproject
            west update 
            west zephyr-export
            pip install -r ~/zephyrproject/zephyr/scripts/requirements.txt

    1.5 Install SDK

        .. code-block:: console

            cd ~
            wget https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.8/zephyr-sdk-0.16.8_linux-x86_64.tar.xz
            tar xvf zephyr-sdk-0.16.8_linux-x86_64.tar.xz
            cd zephyr-sdk-0.16.8
            ./setup.sh

    1.6 Verify if setup works by building a sample hello_world app,

        .. code-block:: console

            cd ~/zephyrproject/zephyr/
            west build -b native_posix samples/hello_world
            ./build/zephyr/zephyr.exe

        press :kbd: `CTRL+C` to quit the app otherwise the kernel will keep Running.

2. Git clone app in the `zephyrproject` workspace.

    2.1 Build the project

        .. code-block:: console

            cd Zephyr-assignment
            west build -b native_posix ./

    2.2 Run the project and get the Output

        .. code-block:: console

            ./build/zephyr/zephyr.exe
    

Sample Output
=============

.. code-block:: console

     ./build/zephyr/zephyr.elf 
    *** Booting Zephyr OS build v3.6.0-5602-g62893328293f ***
    DBG: producer produced 6 random bytes
    DBG: producer produced 13 random bytes
    DBG: producer produced 14 random bytes
    DBG: producer produced 32 random bytes
    DBG: producer produced 33 random bytes
    DBG: producer produced 39 random bytes
    DBG: producer produced 0 random bytes
    DBG: producer produced 37 random bytes
    DBG: producer produced 33 random bytes
    DBG: consumer triggered, Size of buffer is 207
        The number of bytes produced is less than 512, sleeping again
    DBG: producer produced 31 random bytes
    DBG: producer produced 0 random bytes
    DBG: producer produced 2 random bytes
    DBG: producer produced 29 random bytes
    DBG: producer produced 13 random bytes
    DBG: producer produced 35 random bytes
    DBG: producer produced 18 random bytes
    DBG: producer produced 43 random bytes
    DBG: producer produced 22 random bytes
    DBG: producer produced 42 random bytes
    DBG: consumer triggered, Size of buffer is 442
        The number of bytes produced is less than 512, sleeping again
    DBG: producer produced 19 random bytes
    DBG: producer produced 34 random bytes
    DBG: producer produced 3 random bytes
    DBG: producer produced 14 random bytes
    DBG: producer produced 27 random bytes
    DBG: producer produced 4 random bytes
    DBG: producer produced 16 random bytes
    DBG: producer produced 10 random bytes
    DBG: producer produced 39 random bytes
    DBG: producer produced 5 random bytes
    DBG: consumer triggered, Size of buffer is 613
    0x0 0x9f 0x8d 0x65 0x66 0x6e 0x5f 0x2a 0x8a 0xfb 0x57 0x34 0x5 0xc2 0x91 0x83 0x3b 0x75 0xb 0x50 0xc3 0x34 0x43 0x2f 0x27 0x3d 0x12 0xb0 0xa4 0x94 0x5d 0xd4 0x63 0xee 0x6a 0x77 0xdf 0xa1 0x83 0x95 0x9 0x8b 0x21 0xbf 0x6b 0x1d 0x9c 0x33 0x3a 0x19 0xdd 0xf7 0xe0 0xda 0x4d 0xdd 0xd 0xc4 0xe8 0x79 0x32 0x37 0x81 0xbf 0x46 0x63 0x75 0xef 0x14 0xdb 0xdf 0xda 0x96 0x1f 0xdb 0xaf 0x9 0xff 0x47 0x7e 0x60 0x94 0xad 0xdf 0xff 0x82 0xe0 0xd7 0xbf 0xf3 0x7b 0x68 0x33 0xe9 0x78 0xcd 0x3d 0x21 0x9c 0x51 0xd8 0xeb 0x16 0xc1 0x7a 0x67 0x78 0x9b 0x22 0x89 0x2e 0x40 0xe9 0x6e 0x84 0x9e 0xb7 0x2c 0x2b 0x82 0xe1 0xd6 0x5c 0xa4 0xb1 0x3b 0xfa 0x58 0xe1 0xd2 0x9a 0x77 0x98 0x8a 0x9b 0x79 0x83 0x1a 0x63 0x83 0x28 0xc3 0xa5 0x8a 0x8e 0x9a 0xdb 0xea 0x7d 0x7 0xc8 0x88 0x1a 0x67 0x4b 0xf2 0x30 0x12 0xc 0x4d 0x9b 0x99 0xd4 0x6 0xb4 0xc5 0x7f 0xa9 0xda 0x67 0x72 0x19 0xca 0x3b 0xe5 0xfc 0x67 0x69 0x8a 0x4c 0x56 0xd7 0x9b 0x5a 0xa2 0xc5 0xb5 0xad 0x7a 0xd9 0xce 0xe4 0x1b 0x2c 0x42 0x2d 0xd3 0x3d 0x1c 0x3f 0x26 0x53 0xdc 0x9f 0x84 0x24 0x7c 0xd 0x46 0xc1 0x2f 0x96 0x42 0x67 0x46 0xef 0x1b 0xd4 0x37 0x3e 0x33 0xb7 0x1f 0x19 0x6c 0x44 0x7b 0x89 0x94 0xd8 0xf2 0x90 0xeb 0xf7 0x5a 0x1e 0x61 0x41 0x8b 0x64 0xe6 0x86 0x87 0x40 0x5c 0xf5 0xac 0x37 0xa3 0x75 0xde 0x3b 0x67 0x57 0x62 0x2 0xe8 0x4c 0x1a 0xd 0x14 0x76 0xa4 0x6f 0x3e 0xca 0x10 0xb6 0xf8 0xcc 0xc5 0x59 0x79 0xed 0x56 0x2b 0xaa 0xa7 0x94 0xd9 0x40 0x96 0x8f 0x23 0xde 0x48 0x1b 0xc2 0x83 0x29 0x3e 0x86 0x21 0xa5 0x88 0x8c 0x3d 0xfb 0xa9 0x4e 0x1b 0x66 0x3e 0x56 0xa3 0x38 0xfe 0xda 0x6 0xd3 0xbd 0x7c 0x36 0xf2 0x1d 0xe1 0x41 0x81 0xd7 0x70 0x36 0xc 0xcb 0x64 0x9b 0xfc 0x59 0x1d 0x45 0xbc 0xca 0x6e 0x35 0xa7 0xfb 0xc 0x34 0x2a 0x88 0x9 0xa9 0xf0 0x3 0x42 0xec 0x3c 0xcd 0x4f 0x1d 0x74 0x6b 0xe7 0x18 0xa0 0x32 0x6a 0x52 0x50 0x26 0xfa 0x77 0x96 0xe7 0x94 0x9c 0x8f 0xb4 0x6d 0xd6 0x2 0xd 0xa9 0xb6 0x22 0x11 0x5e 0x24 0x68 0x1a 0xd1 0x35 0x54 0x90 0x12 0x8e 0x1 0xdf 0xb5 0x60 0x5a 0xa3 0x62 0xe6 0x23 0xf1 0xa7 0xa4 0xab 0xe3 0xc1 0xaf 0x55 0x83 0xfc 0x71 0xd5 0x27 0xe9 0x59 0x83 0x45 0x9f 0x4a 0x2e 0xed 0xa8 0x25 0xf9 0xe8 0x7b 0x43 0xa 0xac 0x22 0x3d 0xe9 0xac 0xd2 0x1b 0x24 0xf3 0xf4 0xc1 0xed 0x42 0x8a 0x55 0x9d 0x1e 0x5 0x4a 0x40 0x43 0x3c 0xc6 0x5c 0xcc 0x93 0x6f 0xe2 0x1c 0x35 0x7b 0x3d 0x59 0x61 0x81 0x1b 0x2c 0x91 0x23 0x21 0x22 0x3c 0x22 0x12 0xf1 0x6a 0x54 0x77 0xde 0x2 0xc6 0xb 0xc9 0x94 0xb0 0x19 0x2f 0x66 0x8a 0x63 0xba 0x86 0xa0 0x2c 0xd 0x58 0xb4 0x16 0xac 0xf0 0xc7 0x6b 0x6a 0xd6 0x61 0x42 0x94 0x8b 0x7e 0xe0 0x10 0x19 0x4b 0xd7 0xd5 0x32 0xf5 0xde 0x51 0x70 0xa8 
    Remaining bytes: 101
    DBG: producer produced 11 random bytes
    DBG: producer produced 20 random bytes
    DBG: producer produced 1 random bytes
    DBG: producer produced 22 random bytes
    DBG: producer produced 37 random bytes
    DBG: producer produced 18 random bytes
    DBG: producer produced 6 random bytes
    DBG: producer produced 22 random bytes
    DBG: producer produced 49 random bytes
    DBG: producer produced 38 random bytes
    DBG: consumer triggered, Size of buffer is 325
        The number of bytes produced is less than 512, sleeping again
    DBG: producer produced 25 random bytes
    DBG: producer produced 45 random bytes
    DBG: producer produced 26 random bytes
    DBG: producer produced 9 random bytes
    DBG: producer produced 3 random bytes
    DBG: producer produced 25 random bytes
    DBG: producer produced 32 random bytes
    DBG: producer produced 0 random bytes
    DBG: producer produced 19 random bytes
    DBG: producer produced 11 random bytes
    DBG: consumer triggered, Size of buffer is 520
    0xe9 0x27 0x44 0x1f 0x16 0xad 0xf0 0x39 0x96 0x86 0x8f 0xf1 0xa0 0x74 0x92 0x6e 0x3a 0x78 0x9e 0x90 0xe0 0x29 0x4 0x9f 0x7d 0xc4 0x7b 0x41 0x45 0x79 0xee 0x1 0x4b 0xf5 0xd6 0x8b 0x93 0x95 0x93 0xa0 0x2 0x34 0x4b 0x49 0x4a 0xcd 0xe5 0xb6 0xae 0xc2 0x7e 0xf4 0x9a 0xe3 0xba 0xec 0x99 0xf4 0x62 0xe6 0x10 0x4a 0xb0 0x52 0xd 0xcc 0x68 0x75 0x80 0x4a 0x76 0xcb 0xa2 0xd9 0x8d 0x85 0xb4 0x31 0x16 0xb0 0x4c 0xc3 0x3 0x82 0xf1 0xfd 0x86 0x9b 0x5b 0x50 0xbf 0xdd 0xd9 0x9c 0x7b 0x71 0x40 0xf 0xe4 0x7d 0xd8 0xbb 0xee 0xbc 0x80 0xdc 0xdd 0xa1 0x5b 0x75 0xf8 0xf1 0xfa 0x28 0x3b 0xb4 0x16 0x41 0x7d 0x96 0xfb 0x38 0xb6 0xf5 0x7e 0x5c 0x7d 0xe5 0x9 0x66 0x42 0x9a 0x69 0xaa 0x3b 0x47 0x35 0xb5 0xc4 0x33 0x9 0xb8 0x5d 0x66 0xe 0x12 0x3b 0x62 0x5d 0x8f 0x3d 0x89 0xd 0x6c 0x9b 0xca 0x73 0xb1 0x3c 0x55 0x6d 0x30 0xbf 0x68 0x53 0x88 0xda 0x85 0x69 0xf1 0x54 0x0 0xac 0x87 0x7f 0xb0 0x44 0xe6 0xa7 0x88 0xda 0x2a 0x6e 0x59 0x48 0x17 0x8e 0xb9 0x5c 0x67 0x97 0xd3 0x43 0xf6 0x19 0xc4 0xe5 0xc5 0xab 0x72 0x56 0xd9 0xf 0x9a 0x7d 0x85 0xc2 0x1f 0xdb 0xd4 0xcc 0x82 0x8 0xa1 0x44 0x6e 0xec 0xa1 0xef 0x1a 0xb9 0x4d 0x4b 0x1 0x19 0x3e 0x50 0x6a 0x4f 0x6d 0x6a 0xd4 0xe3 0xc9 0xd0 0x0 0x3a 0x5 0xce 0x90 0x67 0xd2 0x81 0xbe 0xe9 0x29 0x6a 0x89 0x79 0xfe 0x92 0x7d 0x56 0xd4 0x1e 0xaf 0x41 0xcb 0xcd 0x2c 0x1b 0x50 0xe7 0xb5 0x71 0x8f 0xcc 0x7 0xd0 0x9e 0x70 0x9b 0xbe 0xe7 0xe4 0x8 0x49 0x90 0x76 0xe6 0xbd 0xef 0xce 0x26 0x2c 0xb2 0xa4 0x68 0x39 0xb7 0x37 0x5e 0x6d 0x67 0xfc 0x3a 0x89 0x32 0xc8 0x57 0x68 0x81 0xc5 0xb7 0xae 0x0 0xc8 0xb8 0x83 0xf9 0x98 0xda 0x1f 0x3f 0x2f 0xd5 0x4b 0x5f 0xb1 0xa2 0x7 0x68 0x4b 0xd2 0x2b 0x16 0x48 0xed 0xf 0xde 0xf7 0xf1 0xe9 0xd7 0xd7 0x44 0x32 0x8e 0x9d 0x9c 0xea 0xfc 0x8b 0xd4 0x92 0x65 0xfe 0x14 0xb2 0x19 0x86 0xfc 0xed 0x47 0xcc 0x81 0x90 0xc0 0x4f 0x85 0xcb 0x89 0xff 0x48 0x8c 0xeb 0x57 0x27 0xe6 0xc1 0x3a 0x8c 0x58 0xd8 0x46 0x57 0x24 0xf2 0x15 0xd3 0x9 0x67 0xc3 0xfb 0x43 0xc0 0x75 0x2f 0xa9 0x4e 0xfa 0x77 0x36 0x99 0x3d 0x46 0xec 0x36 0xa 0x76 0x87 0x58 0xbf 0x6d 0xe1 0x7 0x46 0x6a 0x29 0x2f 0xf9 0xbc 0x7a 0x4f 0x46 0x95 0xa4 0xd5 0xbe 0xb5 0x63 0xdc 0x2d 0xb7 0xa8 0x87 0xbd 0x37 0x2a 0x57 0xf0 0x11 0x29 0xd7 0x77 0x3 0xd5 0x33 0x41 0xc3 0xaa 0xc3 0xb9 0xb4 0x72 0x23 0xd4 0x83 0x78 0x97 0xbb 0x18 0x2c 0xf9 0x73 0x90 0xb1 0x3b 0xac 0x15 0x3c 0x0 0x6d 0x73 0xb1 0x9 0x59 0xe 0xd7 0x28 0x9f 0x2c 0xa0 0x41 0xf4 0xd3 0x89 0xb8 0xf4 0xa4 0x6e 0xeb 0x86 0xcf 0xbf 0x82 0x68 0xe0 0x8 0x77 0x78 0xf7 0x14 0x58 0xd4 0xcd 0xcc 0xf7 0xd5 0xe3 0xd8 0x8a 0x18 0xe4 0x89 0xac 0xa7 0x7c 0x5f 0xb7 0x2d 0xff 0xae 
    Remaining bytes: 8
    DBG: producer produced 42 random bytes
    DBG: producer produced 43 random bytes
    DBG: producer produced 49 random bytes
    DBG: producer produced 1 random bytes
    DBG: producer produced 17 random bytes
    ^C
    Stopped at 55.250s
